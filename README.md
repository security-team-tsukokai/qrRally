# 世田谷祭 QRラリー

- [QRコード掲示について](./docs/sampleqr.pdf)
- **プライベートブラウジングではユーザーデータが消えます(実質使えません)**
- **基本的に最新版Chromeに合わせて動作するようになっています(推奨)**
- 更新されている最新ブラウザでしたらほとんど動作します

## セットアップ手順
**クイックスタートガイドを参照**<br>
https://tsukokai-securityteam.github.io/qrRally/



## セットアップする前に…用意する環境
- 4コア以上, Webサーバ向けの帯域やIOPSあるかなど…
- セキュリティ設定
- ntpの設定 (正確な時刻になるように)
- **Docker, Docker Compose, Git などのインストール**

### 最低限のセキュリティ設定について
- sshd_config (ポート変更や鍵認証など…)
- 80、443、SSHポート以外塞ぐ (ufwなど利用)



## トップページHTMLのイベント情報の更新
**/webpage/index.html** がトップページです。

都度HTMLのコメントに従って書き換えてください。



## 集計データ、DBデータの取得、ユーザの交換可能景品の確認
https://(ドメイン名)/operationpage/ より利用できます



## サーバ終了(コンテナ削除)
container_data ディレクトリ内に証明書やDBデータは残ります。
```bash
#qrRallyディレクトリで
./stopsrv.sh
#コンテナの削除
sudo docker rm -f qrserver
```

これ自体消すにはroot権限が必要です(保存された証明書等含まれるためなど)



## 注意事項
- 基本的に一度設定した設定はQRラリーイベント終了まで変更しないほうが安全です
- 設定を変更した場合 ./restartsrv.sh を実行してください (サーバ再起動で反映するため)
- (Docker) これは1コンテナ1プロセスではありません。
- **(証明書発行)LetsEncryptのリミットに注意してください**



## (追加機能)
- 「url_」で始まり直後にURLを記述したQRを読み込めます。(リンクに飛べます。)
  - 例: url_https://www.google.co.jp
